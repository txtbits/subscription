# Subscription API

Development of a subscription API based on distributed microservices with Spring Boot
---
A simple REST-based endpoint is available to subscribe via POST requests.
The main service persists the subscription in the database and subsequently informs the email service with it. After processing (simulation) it returns a confirmation response to the main service.

The project is made up of three independent modules/services:
- **Eureka Server**: to locate, manage and balance the instances of registered services.
- **Main subscription service**: REST API with database persistence through Hibernate and playground Swagger and communication with microservices.
- **Email microservice**: Simulates sending an email service and notifies the main subscription service.

**HyperSQL Database** is used for the dev profile, easy and quick to use for testing without additional configuration. In the docker profile, **MySQL 5.7 Database** docker image is used. In both of them, the DDL is automatic through Hibernate, so database is autogenerated.

Tools needed to build the project:
- **Java JDK 8**.
- **Gradle** (included in project with Gradle Wrapper).
- **Docker** (optional).

The development startup has been done using the utility [Spring Initializr](https://start.spring.io/) to initialize Spring Boot projects with some selected dependencies. The technologies used in the project are:
- **Spring Boot**: Open source Java-based framework used to create a micro Services.
- **Spring Web**: Build web, including RESTful, applications using Spring MVC. Uses Apache Tomcat as the default embedded container.
- **Spring Data JPA**: Persist data in SQL stores with Java Persistence API using Spring Data and Hibernate.
- **Eureka Server**: A useful service registry that enables client-side load-balancing and decouples service providers from consumers without the need for DNS.
- **HyperSQL Database**: Lightweight 100% Java SQL Database Engine for fast test for development deployment.
- **Mysql 5.7 Database and Mysql driver**: MySQL Database docker image and neccesary JDBC and R2DBC driver for docker deployment.
- **Spring Configuration Processor**: Generate metadata for developers to offer contextual help and "code completion" when working with custom configuration keys (ex.application.properties/.yml files).
- **Lombok**: Java annotation library which helps to reduce boilerplate code.

The project has two different building profiles:
- **Dev**: To easily and quickly deploy the project only using gradle.
- **Docker & Docker Compose**: To deploy using Docker technology and the Docker Compose. Tool for defining and running multi-container Docker applications.

## Building and running for dev profile
To build the project you must use gradle. You must go into the directory of each module and execute:
```
gradle clean build
```
The process must be repeated in each directory.

It is necessary to start the services following a specific order:
1. Eureka Server _./eurekaserver_
```
java -jar build/libs/eurekaserver-0.0.1-SNAPSHOT.jar --spring.profiles.active=dev
```
2. Email Service _./email_
```
java -jar build/libs/email-0.0.1-SNAPSHOT.jar --spring.profiles.active=dev
```
3. Subscription Service _.subscriptionservice_
```
java -jar build/libs/subscriptionservice-0.0.1-SNAPSHOT.jar --spring.profiles.active=dev
```

* To access to Eureka server and check the service registry: [http://localhost:8761/](http://localhost:8761/)
* To access to the Subscription API Swagger Playground: [http//localhost:8886/swagger-ui.html](http//localhost:8886/swagger-ui.html)
    * You may add a new subscription record making a POST HTTP request to [http//localhost:8886/subscription/](http//localhost:8886/subscription/). You can do it easily throught Swagger Playground populating body parameter and clicking at 'Try it out!' button.

## Building and running for docker profile

To build the project with Docker, you must first build the docker images using the Dockerfile file included in each directory.
```
docker build -t eureka .
```
```
docker build -t subcription .
```
```
docker build -t email .
```
The Dockerfile files of each module already have the `spring.profiles.active=docker` parameter when executing the jar file.
The docker images must have the same names for the Docker Compose Tool to recognize them and to create the bundle correctly.

The docker-compose.yml file contains all the necessary configuration to launch the containers simultaneously and run the dockerized environment.

To launch the bundle you must run:
```
docker-compose up -d
```
In the same way as in the dev profile:
* To access to Eureka server and check the service registry: [http://localhost:8761/](http://localhost:8761/)
* To access to the Subscription API Swagger Playground: [http//localhost:8886/swagger-ui.html](http//localhost:8886/swagger-ui.html)
    ** You may add a new subscription record making a POST HTTP request to [http//localhost:8886/subscription/](http//localhost:8886/subscription/). You can do it easily throught Swagger Playground populating body parameter and clicking at _'Try it out!'_ button.

To stop the instance and remove all containers, use:
```
docker-compose down
```